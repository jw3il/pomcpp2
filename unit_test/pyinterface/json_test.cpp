#include "catch.hpp"
#include "bboard.hpp"
#include "from_json.hpp"
#include <tuple>

// some state and the corresponding observation
// note: the step count does not match because self._step_count is incremented AFTER the observations for the step are generated (bug in python env)
#define FFA "FFA"
#define JSON_STATE "{\"game_type\": 1, \"board_size\": 11, \"step_count\": 30, \"board\": [[0, 0, 1, 1, 1, 1, 1, 1, 4, 4, 4], [0, 0, 0, 3, 2, 2, 2, 3, 13, 4, 7], [1, 0, 0, 1, 2, 1, 0, 2, 1, 0, 1], [1, 10, 1, 0, 0, 2, 2, 1, 0, 0, 1], [1, 6, 2, 0, 0, 0, 1, 0, 0, 2, 1], [1, 2, 1, 2, 0, 0, 0, 2, 0, 2, 2], [1, 2, 0, 2, 1, 0, 0, 2, 0, 2, 1], [1, 0, 2, 1, 0, 2, 2, 0, 1, 0, 1], [0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1], [3, 0, 0, 0, 11, 2, 2, 0, 0, 0, 6], [2, 0, 1, 1, 1, 2, 1, 1, 1, 6, 0]], \"agents\": [{\"agent_id\": 0, \"is_alive\": true, \"position\": [3, 1], \"ammo\": 0, \"blast_strength\": 2, \"can_kick\": false}, {\"agent_id\": 1, \"is_alive\": true, \"position\": [9, 4], \"ammo\": 0, \"blast_strength\": 2, \"can_kick\": true}, {\"agent_id\": 2, \"is_alive\": false, \"position\": [9, 8], \"ammo\": 1, \"blast_strength\": 2, \"can_kick\": false}, {\"agent_id\": 3, \"is_alive\": true, \"position\": [1, 8], \"ammo\": 0, \"blast_strength\": 2, \"can_kick\": true}], \"bombs\": [{\"position\": [9, 0], \"bomber_id\": 1, \"life\": 3, \"blast_strength\": 2, \"moving_direction\": null}, {\"position\": [1, 3], \"bomber_id\": 0, \"life\": 5, \"blast_strength\": 2, \"moving_direction\": null}, {\"position\": [1, 7], \"bomber_id\": 3, \"life\": 8, \"blast_strength\": 2, \"moving_direction\": null}], \"flames\": [{\"position\": [0, 8], \"life\": 0}, {\"position\": [0, 9], \"life\": 0}, {\"position\": [0, 10], \"life\": 0}, {\"position\": [1, 9], \"life\": 0}], \"items\": [[[6, 9], 6], [[10, 5], 6], [[7, 5], 7], [[6, 1], 7], [[1, 4], 8], [[1, 5], 6], [[9, 5], 7], [[3, 5], 6], [[1, 6], 8], [[5, 9], 6], [[6, 3], 8], [[2, 4], 7], [[9, 6], 8], [[6, 7], 8]], \"intended_actions\": [2, 0, 0, 4]}"
#define JSON_OBS "{\"alive\": [10, 11, 13], \"board\": [[0, 0, 1, 1, 1, 1, 1, 1, 4, 4, 4], [0, 0, 0, 3, 2, 2, 2, 3, 13, 4, 7], [1, 0, 0, 1, 2, 1, 0, 2, 1, 0, 1], [1, 10, 1, 0, 0, 2, 2, 1, 0, 0, 1], [1, 6, 2, 0, 0, 0, 1, 0, 0, 2, 1], [1, 2, 1, 2, 0, 0, 0, 2, 0, 2, 2], [1, 2, 0, 2, 1, 0, 0, 2, 0, 2, 1], [1, 0, 2, 1, 0, 2, 2, 0, 1, 0, 1], [0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 1], [3, 0, 0, 0, 11, 2, 2, 0, 0, 0, 6], [2, 0, 1, 1, 1, 2, 1, 1, 1, 6, 0]], \"bomb_blast_strength\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [2.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"bomb_life\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 5.0, 0.0, 0.0, 0.0, 8.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"bomb_moving_direction\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"flame_life\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"game_type\": 1, \"game_env\": \"pommerman.envs.v0:Pomme\", \"position\": [1, 8], \"blast_strength\": 2, \"can_kick\": true, \"teammate\": 9, \"ammo\": 0, \"enemies\": [10, 11, 12], \"step_count\": 29, \"max_bombs\": 1}"

#define TEAM "TEAM"
#define JSON_STATE_TEAM "{\"game_type\": 2, \"board_size\": 11, \"step_count\": 84, \"board\": [[0, 11, 1, 1, 2, 0, 0, 1, 1, 0, 1], [0, 4, 4, 10, 3, 2, 2, 0, 0, 0, 8], [1, 4, 4, 4, 1, 0, 0, 1, 2, 0, 1], [1, 4, 4, 0, 2, 1, 1, 0, 2, 0, 0], [0, 0, 1, 2, 0, 1, 0, 2, 1, 8, 1], [0, 0, 0, 1, 1, 0, 0, 2, 1, 0, 1], [0, 0, 0, 1, 0, 0, 0, 2, 1, 0, 0], [1, 0, 1, 0, 2, 2, 2, 0, 1, 0, 1], [1, 0, 2, 8, 1, 1, 1, 1, 0, 0, 0], [0, 0, 0, 0, 8, 2, 3, 0, 0, 0, 0], [1, 0, 1, 0, 1, 1, 2, 1, 0, 12, 0]], \"agents\": [{\"agent_id\": 0, \"is_alive\": true, \"position\": [1, 3], \"ammo\": 1, \"blast_strength\": 4, \"can_kick\": false}, {\"agent_id\": 1, \"is_alive\": true, \"position\": [0, 1], \"ammo\": 2, \"blast_strength\": 2, \"can_kick\": false}, {\"agent_id\": 2, \"is_alive\": true, \"position\": [10, 9], \"ammo\": 1, \"blast_strength\": 2, \"can_kick\": true}, {\"agent_id\": 3, \"is_alive\": false, \"position\": [0, 9], \"ammo\": 1, \"blast_strength\": 2, \"can_kick\": false}], \"bombs\": [{\"position\": [9, 6], \"bomber_id\": 2, \"life\": 1, \"blast_strength\": 2, \"moving_direction\": null}, {\"position\": [1, 4], \"bomber_id\": 0, \"life\": 8, \"blast_strength\": 4, \"moving_direction\": null}], \"flames\": [{\"position\": [1, 1], \"life\": 0}, {\"position\": [1, 2], \"life\": 0}, {\"position\": [2, 1], \"life\": 0}, {\"position\": [2, 2], \"life\": 0}, {\"position\": [2, 3], \"life\": 0}, {\"position\": [3, 1], \"life\": 0}, {\"position\": [3, 2], \"life\": 0}], \"items\": [[[8, 2], 6], [[5, 7], 8], [[9, 5], 7], [[2, 8], 6], [[3, 4], 7], [[1, 5], 7]], \"intended_actions\": [3, 4, 2, 0]}"
#define JSON_OBS_TEAM "{\"alive\": [10, 11, 12], \"board\": [[0, 11, 1, 1, 2, 0, 0, 1, 1, 0, 1], [0, 4, 4, 10, 3, 2, 2, 0, 0, 0, 8], [1, 4, 4, 4, 1, 0, 0, 1, 2, 0, 1], [1, 4, 4, 0, 2, 1, 1, 0, 2, 0, 0], [0, 0, 1, 2, 0, 1, 0, 2, 1, 8, 1], [0, 0, 0, 1, 1, 0, 0, 2, 1, 0, 1], [0, 0, 0, 1, 0, 0, 0, 2, 1, 0, 0], [1, 0, 1, 0, 2, 2, 2, 0, 1, 0, 1], [1, 0, 2, 8, 1, 1, 1, 1, 0, 0, 0], [0, 0, 0, 0, 8, 2, 3, 0, 0, 0, 0], [1, 0, 1, 0, 1, 1, 2, 1, 0, 12, 0]], \"bomb_blast_strength\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 4.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"bomb_life\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 8.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"bomb_moving_direction\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"flame_life\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"game_type\": 2, \"game_env\": \"pommerman.envs.v0:Pomme\", \"position\": [1, 3], \"blast_strength\": 4, \"can_kick\": false, \"teammate\": 12, \"ammo\": 1, \"enemies\": [11, 13, 9], \"step_count\": 83, \"max_bombs\": 2}"

#define RADIO "TEAMRADIO"
#define JSON_STATE_RADIO "{\"game_type\": 3, \"board_size\": 11, \"step_count\": 38, \"board\": [[0, 0, 0, 1, 2, 1, 1, 1, 4, 1, 0], [0, 0, 0, 0, 0, 2, 2, 4, 4, 4, 0], [0, 10, 0, 1, 0, 1, 1, 1, 4, 0, 0], [1, 3, 1, 0, 1, 0, 1, 1, 1, 0, 1], [2, 2, 0, 1, 0, 2, 2, 2, 2, 2, 0], [1, 2, 1, 0, 2, 0, 0, 2, 1, 2, 2], [1, 3, 1, 1, 2, 0, 0, 1, 0, 2, 6], [1, 11, 1, 1, 2, 2, 1, 0, 1, 0, 0], [2, 3, 0, 1, 2, 1, 0, 1, 0, 0, 1], [1, 0, 0, 0, 8, 2, 7, 12, 0, 0, 0], [0, 0, 0, 1, 0, 2, 2, 0, 1, 0, 0]], \"agents\": [{\"agent_id\": 0, \"is_alive\": true, \"position\": [2, 1], \"ammo\": 0, \"blast_strength\": 3, \"can_kick\": false}, {\"agent_id\": 1, \"is_alive\": true, \"position\": [7, 1], \"ammo\": 0, \"blast_strength\": 2, \"can_kick\": false}, {\"agent_id\": 2, \"is_alive\": true, \"position\": [9, 7], \"ammo\": 1, \"blast_strength\": 2, \"can_kick\": true}, {\"agent_id\": 3, \"is_alive\": false, \"position\": [1, 7], \"ammo\": 1, \"blast_strength\": 2, \"can_kick\": false}], \"bombs\": [{\"position\": [6, 1], \"bomber_id\": 1, \"life\": 1, \"blast_strength\": 2, \"moving_direction\": null}, {\"position\": [8, 1], \"bomber_id\": 1, \"life\": 6, \"blast_strength\": 2, \"moving_direction\": null}, {\"position\": [3, 1], \"bomber_id\": 0, \"life\": 8, \"blast_strength\": 3, \"moving_direction\": null}], \"flames\": [{\"position\": [0, 8], \"life\": 0}, {\"position\": [1, 7], \"life\": 0}, {\"position\": [1, 8], \"life\": 0}, {\"position\": [1, 9], \"life\": 0}, {\"position\": [2, 8], \"life\": 0}], \"items\": [[[5, 7], 7], [[5, 10], 6], [[5, 9], 7], [[4, 5], 7], [[9, 5], 8], [[1, 6], 6], [[8, 4], 7], [[4, 7], 8], [[7, 5], 7], [[0, 8], 8], [[10, 5], 8], [[0, 4], 8], [[5, 4], 8], [[5, 1], 7]], \"intended_actions\": [1, 0, 3, 0], \"radio_from_agent\": {\"10\": [0, 0], \"11\": [0, 0], \"12\": [0, 0], \"13\": [0, 0]}, \"teammate\": 12, \"message\": [0, 0]}"
#define JSON_OBS_RADIO  "{\"alive\": [10, 11, 12], \"board\": [[0, 0, 0, 1, 2, 1, 5, 5, 5, 5, 5], [0, 0, 0, 0, 0, 2, 5, 5, 5, 5, 5], [0, 10, 0, 1, 0, 1, 5, 5, 5, 5, 5], [1, 3, 1, 0, 1, 0, 5, 5, 5, 5, 5], [2, 2, 0, 1, 0, 2, 5, 5, 5, 5, 5], [1, 2, 1, 0, 2, 0, 5, 5, 5, 5, 5], [1, 3, 1, 1, 2, 0, 5, 5, 5, 5, 5], [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5], [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5], [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5], [5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5]], \"bomb_blast_strength\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 3.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 2.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"bomb_life\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 8.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"bomb_moving_direction\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"flame_life\": [[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0], [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]], \"game_type\": 3, \"game_env\": \"pommerman.envs.v2:Pomme\", \"position\": [2, 1], \"blast_strength\": 3, \"can_kick\": false, \"teammate\": 12, \"ammo\": 0, \"enemies\": [11, 13, 9], \"step_count\": 37, \"message\": [0, 0], \"max_bombs\": 1}"

typedef std::vector<std::tuple<std::string, std::string>> PairType;
typedef std::vector<std::tuple<std::string, std::string, int>> TripleType;

bool print = true;

PairType allStates = (PairType){{FFA, JSON_STATE}, {TEAM, JSON_STATE_TEAM}, {RADIO, JSON_STATE_RADIO}};
TripleType allObservations = (TripleType){{FFA, JSON_OBS, 3}, {TEAM, JSON_OBS_TEAM, 0}, {RADIO, JSON_OBS_RADIO, 0}};

TEST_CASE("Load State", "[json]")
{
    for (auto pair : allStates)
    {
        SECTION(std::get<0>(pair))
        {
            std::string jState = std::get<1>(pair);
            bboard::State s = StateFromJSON(jState);
            if (print) {
                std::cout << std::endl << std::get<0>(pair) << " > Loaded state:" << std::endl;
                s.Print();
            }
        }
    }
}

TEST_CASE("Load Observation", "[json]")
{
    for (auto triple : allObservations)
    {
        SECTION(std::get<0>(triple))
        {
            std::string jObs = std::get<1>(triple);
            bboard::Observation o = ObservationFromJSON(jObs, std::get<2>(triple));
            if (print) {
                std::cout << std::endl << std::get<0>(triple) << " > Loaded observation:" << std::endl;
                o.Print();
            }
        }
    }
}

TEST_CASE("Reconstruct State", "[json]")
{
    for (int i = 0; i < allStates.size(); i++)
    {
        auto statePair = allStates[i];
        auto observationTriple = allObservations[i];

        auto mode = std::get<0>(statePair);
        SECTION(mode)
        {
            std::string jState = std::get<1>(statePair);
            bboard::State realState = StateFromJSON(jState);

            std::string jObs = std::get<1>(observationTriple);
            bboard::Observation o = ObservationFromJSON(jObs, std::get<2>(observationTriple));
            bboard::State reconstructedState;
            o.ToState(reconstructedState);

            if (print) {
                std::cout << std::endl << mode << " > Reconstructed state:" << std::endl;
                reconstructedState.Print();

                std::cout << "Alive agents: " << realState.aliveAgents << std::endl;
            }

            if (mode == FFA || mode == TEAM) {
                REQUIRE(reconstructedState.bombs.count == realState.bombs.count);
            }

            REQUIRE(realState.aliveAgents == reconstructedState.aliveAgents);
            for(auto j = 0; j < bboard::AGENT_COUNT; j++)
            {
                if (reconstructedState.agents[j].visible)
                {
                    REQUIRE(realState.agents[j].x == reconstructedState.agents[j].x);
                    REQUIRE(realState.agents[j].y == reconstructedState.agents[j].y);
                }
                REQUIRE(realState.agents[j].dead == reconstructedState.agents[j].dead);
                REQUIRE(realState.agents[j].team == reconstructedState.agents[j].team);
            }
        }
    }
}